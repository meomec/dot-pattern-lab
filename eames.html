<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="eames.css">
    <title>Charles Eames</title>
</head>
<body>
    <div class="controls">
        <label for="motif-selector">Choisir un motif :</label>
        <select id="motif-selector">
            <option value="all" selected>Tous les motifs</option>
            <option value="0">Motif 1</option>
            <option value="1">Motif 2</option>
            <option value="2">Motif 3</option>
            <option value="3">Motif 4</option>
            <option value="4">Motif 5</option>
            <option value="5">Motif 6</option>
        </select>
    </div>

    <div class="pattern">
        <div class="motif" id="motif-1" data-dimension-w="130.732" data-dimension-h="198.459" data-frequency="0.2">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 130.7 198.5" style="enable-background:new 0 0 130.7 198.5;" xml:space="preserve">
                <g id="m1-assembly" class="assembly-collapse">
                    <g id="tree">
                        <path id="branch5" d="M66.4,129.4c.5,3.2,1.3,5.9,2.5,7.9,3.8,6.2,8,2.9,13.7,3.2,4.7.3,22.7,2.6,25.5.6.8-.6,1.3-1.5,1.7-2.4,0,0,.5,3.7.6,5.4s-1.4,3.5-1.4,3.5c-.7-1-1.4-1.8-2.4-2-4.7-.9-33.8.6-37.1,2.9-.9.7-1.7,2.7-2.3,5.3,0,0-1.9-5.5-1.9-12.2s1-12.2,1-12.2Z"/>
                        <path id="branch4" d="M61.1,151.8c-.3-2-.7-3.5-1.2-4-2.4-2.4-32.2-.9-38.2-2.3,0,0-.6-.7-1-2.3s.6-2.9.6-2.9c0,.1.1.2.2.3,1.3,1.6,21.2,1.2,24.9.9,4.1-.4,10.8-1.2,13.1-4.9.7-1.2,1.2-3.6,1.5-6.6,0,0,2.8,7.3,2.8,11.7s-2.7,10.2-2.7,10.2Z"/>
                        <path id="branch3" d="M65,39.8c0,1.1.1,1.9.2,2.2.6,3.8,3.9,6,7.5,6.5,1.5.2,14.2.9,15,.7.3,0,.6-.3.8-.7,0,0,.8.9.8,2.6s-.8,1.4-.8,1.4c-3.8-.6-16,.6-19,3-.6.5-3,1.5-3.3,2.3,0,0-1.6-1.2-2-7.4s.8-10.7.8-10.7Z"/>
                        <path id="branch2" d="M60.4,57c-.6-1.8-3.2-3.2-6.1-4.2-2-.7-12.5-2.1-13.2-1.3,0,0-.8-.2-.8-1.4s1.1-1.9,1.1-1.9c.1.2.2.3.3.3,2.4.6,16.5-1.3,17.8-3.1.3-.4.6-1.5.9-2.9,0,0,1.2,1.8,1.2,7.2s-1.2,7.2-1.2,7.2Z"/>
                        <path id="branch1" d="M66.7,57.2c-.8,7.7,1.7,19.2-.7,24.8,1.6,10.7.3,45.7.4,47.3s1.3,19.9.8,24.4-1.7,17.3-1.1,20.3c.1.7.5,1.3.9,1.9,0,0-1.2,1.9-2.4,1.9s-3.6-2-3.6-2c.6-.5.9-1.1,1.1-1.7.5-2.7-1-16.4-1-22.3s0-18.1,0-21.9,0-23.3,0-28.9c.1-11-.8-35.8-.8-50.3s0-6.1.2-8.1c.6-10.5,1.2-17.1.7-19.4,0,0-.6-2.2,1.2-1.7,3-1.5,3,.9,3,.9-.1,0-.2,0-.2.1-.6.6-.4,12-.1,17.2l1.7,17.4Z"/>
                    </g>
                    <path id="disc6" d="M67,175.9c2.7,3.1,9.5,4.5,8,14.1-2.2,14.1-30.9,9.9-21.8-7.8,1.6-3.2,5.8-4.5,7.8-6.4h6Z"/>
                    <path id="disc5" d="M109.8,138.7c1.1-2.6,2.1-5.7,9.7-5.1,15.3,1.1,15.4,24.5-2.8,20.8-4.7-1-6.2-4.5-7.8-6.8l.8-8.9Z"/>
                    <path id="disc4" d="M21.7,145.5c-2.4,13.5-22.3,9.1-21.7-3.4.4-8.9,11.3-13.2,18-8,2.7,2.1,2.3,4.6,3.3,6.2l.3,5.2Z"/>
                    <path id="disc3" d="M88.5,48.6c1.4-2.1,2.7-8.1,11-7,5.4.7,9.4,5.1,9.7,10.4.9,16.1-19,14.3-20.6.5v-3.9Z"/>
                    <path id="disc2" d="M41.1,51.6c-.7.7,1.6,6.6-5,9.5-18.3,8-23-23.5-3.6-20.4,6,1,8,6.2,8.9,7.6l-.3,3.3Z"/>
                </g>
                <path id="disc1" d="M61.1,23.2c-.2-.8-8.9-3.1-9.1-12.2-.5-19.1,30.6-11.4,20.6,7.6-2.5,4.7-6.2,3.6-7.3,3.9l-4.2.7Z"/>
            </svg>
        </div>

        <div class="motif" id="motif-2" data-dimension-w="136.575" data-dimension-h="136.378" data-frequency="0.1">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 136.575 136.378" style="enable-background:new 0 0 136.575 136.378;" xml:space="preserve">
                <g id="m2-assembly" class="assembly-collapse">
                    <g id="tree">
                        <path id="branch2" d="M54.543,55.526c0.281,5.493,0.644,9.821,1.038,10.996c0.48,1.428,1.614,2.376,2.78,3.22l33.435,2.565
                            c5.567-0.979,14.894,1.186,19.871-0.002c0,0,0.663,0.06,0.663,1.342c0,1.283-0.663,1.579-0.663,1.579
                            c-15.129,1.385-33.085-1.719-47.853,0.017c-3.271,0.385-6.322,2.232-7.708,5.292c-1.097,2.423-1.805,9.88-2.074,17.015
                            c0,0-2.473-15.475-2.473-22.804S54.543,55.526,54.543,55.526z"/>
                        <path id="branch3" d="M21.031,69.511c0.103,0.689,0.214,1.249,0.486,1.573c1.396,1.664,24.942,0.364,26.831-1.308
                            c1.316-1.164,1.874-5.75,2.069-11.637c0,0,2.772,1.949,2.772,15.793S52.413,97.55,52.413,97.55
                            c-0.343-8.151-1.499-16.825-3.023-18.837c-0.771-1.017-1.942-1.448-3.06-1.94c-2.829-1.245-22.143-3.341-24.03-2.042
                            c0,0-1.196,0.342-2.01-1.613C19.475,71.164,21.031,69.511,21.031,69.511z"/>
                        <path id="branch1" d="M54.331,111.772c-0.438-2.297-0.528-8.143-0.299-14.222l0.51-42.025c-0.635-12.436-0.848-30.839-0.046-32.105
                            c0,0,0.439-0.873-2.145-0.873s-1.951,1.328-1.951,1.328c-0.38,2.58-0.233,8.794-0.077,15.855c0.135,6.102-0.228,12.066,0.093,18.409
                            c0.321,6.343,0.54,10.66,0.672,13.263s1.325,26.147,1.325,26.147c0.306,7.267-0.034,14.118-1.333,15.465c0,0,0.755,0.483,2.109,0
                            C54.543,112.532,54.331,111.772,54.331,111.772z"/>
                    </g>
                    <path id="disc2" d="M111.668,75.226c2.858,9.952,13.933,14.042,21.714,6.583c10.242-9.818-6.478-24.349-17.425-16.425
                        c-2.397,1.735-3.181,6.656-4.289,6.921L111.668,75.226z"/>
                    <path id="disc3" d="M22.3,74.731c-1.189,0.818-1.162,4.408-5.265,6.733c-20.004,11.334-24.99-26.792-0.747-18.649
                        c4.209,1.414,4.436,4.631,4.743,6.696L22.3,74.731z"/>
                    <path id="disc4" d="M54.497,23.421c0.167-0.263,3.866-1.316,5.405-3.095c4.9-5.665,2.057-17.898-5.305-19.81
                        c-16.767-4.357-18.838,20.244-4.195,23.36L54.497,23.421z"/>
                </g>
                <path id="disc1" d="M54.331,111.772c0.588,3.082,4.592,3.217,6.363,5.74c12.971,18.479-18.831,27.234-19.398,8.218
                    c-0.298-9.993,6.126-8.925,9.783-12.715L54.331,111.772z"/>
            </svg>
        </div>

        <div class="motif" id="motif-3" data-dimension-w="128.486" data-dimension-h="168.967" data-frequency="0.1">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 128.486 168.967" style="enable-background:new 0 0 128.486 168.967;" xml:space="preserve">
                <path d="M68.724,19.473c-1.267,1.133-5.45,1.836-5.728,2.991c-0.794,3.29-0.369,22.514,0.046,26.818
                    c0.262,2.722,2.035,10.453,3.505,12.495c3.43,4.762,12.893,4.705,17.811,3.042c0.938-0.317,1.434-7.901,8.237-8.975
                    c19.76-3.121,18.515,27.149-1.959,18.845c-4.185-1.697-4.034-4.508-6.028-5.972c-2.569-1.887-15.496-1.38-18.138,1.01
                    c-3.819,3.455-3.031,28.154-0.343,32.47c4.268,6.851,21.914,3.571,28.402,3.507c3.348-0.033,8.301,2.5,11.498,0.577
                    c3.62-2.177,1.848-8.477,12.508-7.535c23.355,2.065-0.234,39.964-11.557,11.057c-9.44,2.962-35.388-4.427-40.017,7.415
                    c-1.135,2.904-1.725,25.797-0.976,28.917c0.336,1.402,7.814,0.75,8.953,9.243c2.526,18.826-19.304,15.403-20.842,5.857
                    c-1.248-7.745,0.971-12.064,7.98-15.109c-0.198-7.007,2.033-28.2-3.069-32.81c-4.842-4.376-28.821-2.369-36.304-3.565
                    c-2.79,7.115-8.855,13.062-16.625,8.492c-11.867-6.98-5.325-27.14,10.697-20.695c6.285,2.528,2.129,8.879,10.797,9.258
                    c3.41,0.149,5.899-0.99,8.919-1.056c8.618-0.189,21.936,3.481,23.449-7.552c0.519-3.785,1.126-12.034,1.177-15.91
                    c0.028-2.129-1.469-11.266-2.565-12.517c-1.241-1.417-12.814-2.519-14.86-1.813c-2.697,0.931-4.413,8.823-13.063,7.808
                    c-15.862-1.861-12.816-28.078,6.425-20.488c6.575,2.594,5.324,8.773,6.019,9.471c0.661,0.664,15.658,1.909,16.498-4.424
                    c1.28-9.653,0.418-22.099,0.415-32.079c0-1.619,1.08-3.977,0.881-4.866c-0.501-2.244-9.909-2.478-10.861-11.074
                    C49.218,5.208,51.981,1.522,59.004,0.19C70.008,-1.897,75.088,13.782,68.724,19.473z"/>
            </svg>
        </div>

        <div class="motif" id="motif-4" data-dimension-w="112.557" data-dimension-h="131.027" data-frequency="0.08">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 112.557 131.027" style="enable-background:new 0 0 112.557 131.027;" xml:space="preserve">
                <path d="M89.022,70.781c1.873-1.174,0.957-8.738,10.767-9.773c21.533-2.271,12.578,28.822-2.983,20.807
                    c-2.636-1.358-6.284-7.485-7.212-7.704c-6.256,1.763-23.57-0.133-27.888,4.859c-2.851,3.296-1.927,24.838-2.587,30.407
                    c12.138,1.978,14.038,21.3-0.441,21.646c-12.537,0.299-16.575-12.485-7.004-20.084c1.123-0.892,3.428-1.066,4.044-1.957
                    c1.549-2.241-0.689-28.537-3.043-31.031c-2.437-2.583-26.073-4.958-29.829-4.049c-0.465,0.113-2.411,5.069-6.141,7.068
                    C5.388,87.032-1.414,80.453,0.249,68.507c1.397-10.031,15.699-9.662,20.36-2.491c0.886,1.363,1.077,4.699,2.227,4.975
                    c3.973,0.953,28.837-0.646,30.863-4.03c-0.041-13.382,2.955-28.188,1.362-41.42c-0.895-7.436-9.671-6.916-8.944-16.089
                    c1.016-12.813,19.945-12.83,20.496,1.353c0.378,9.741-7.962,9.091-8.485,12.666c-0.28,1.917,1.025,4.611,1.096,6.931
                    c0.248,7.996-1.667,30.741,1.722,36.277c1.678,2.741,8.512,3.811,11.857,4.143C75.072,71.048,88.141,71.333,89.022,70.781z"/>
            </svg>
        </div>

        <div class="motif" id="motif-5" data-dimension-w="183.55" data-dimension-h="158.133" data-frequency="0.2">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 183.55 158.133" style="enable-background:new 0 0 183.55 158.133;" xml:space="preserve">
                <path d="M80.939,7.882c4.274,2.722,58.251-3.269,67.323-0.865c3.724-0.709,4.458-5.93,12.026-6.057
                    c15.843-0.267,11.903,20.232,0.84,20.787c-8.836,0.444-10.998-11.518-11.998-11.756c-12.966,0.842-27.08-2.178-39.145,3.248
                    c-0.961,4.787-1.317,9.433-1.238,14.345c0.071,4.372,0.587,12.614,1.134,16.857c0.165,1.281,0.9,4.52,1.86,5.14
                    c0.487,0.315,9.804,1.393,11.501,1.499c9.1,0.568,18.87-0.349,28.083-0.082c2.67,0.077,5.382,1.379,7.961,1.153
                    c1.901-0.166,3.751-5.14,6.754-6.355c18.521-7.491,24.066,19.154,8.23,20.302c-8.683,0.629-9.742-7.063-14.982-11.063
                    c-8.132,1.102-44.313-2.712-48.226,3.282c-2.341,3.585-2.105,16.094,2.327,18.617c1.068,0.608,7.068,2.161,7.825,1.97
                    c1.654-0.417,1.989-8.159,9.304-9.642c16.57-3.36,19.225,19.684,3.504,20.546c-9.547,0.524-8.078-9.758-18.743-7.765
                    c-3.22,0.602-3.303,3.773-3.542,6.449c-1.007,11.251-1.11,34.913,0.05,46.044c0.297,2.854,0.66,5.208,3.261,6.739
                    c3.29,1.937,15.061,3.466,19.247,3.753c5.271,0.362,19.411,0.886,23.998,0.018c2.421-0.458,3.683-4.755,7.488-6.506
                    c11.973-5.51,21.199,10.369,10.335,17.33c-8.385,5.373-14.527,0.542-16.99-7.878l-73.845,0.042
                    c-3.266,0.616-3.103,7.562-11.068,7.931c-14.855,0.689-15.856-22.425-0.02-20.91c7.103,0.679,8.562,8.862,9.216,9.042
                    c1.856,0.509,13.19,0.111,15.636-0.299c11.459-1.92,9.028-13.011,8.781-22.302c-0.255-9.585-0.698-23.652-2.096-32.904
                    c-0.712-4.712-5.199-6.869-9.532-7.465c-2.553-0.352-18.761,0.411-20.756,1.068c-2.1,0.691-2.509,7.03-9.254,7.819
                    c-15.893,1.86-15.735-21.517-1.04-20.655c7.991,0.469,7.416,8.364,12.351,9.464c3.67,0.818,22.566-0.129,25.548-1.775
                    c3.384-1.868,4.873-19.721-1.286-21.488c-26.037-2.239-52.181-1.343-78.312-1.566C18.079,69.006-5.184,64.737,1.054,47.8
                    c4.123-11.195,21.811-8.713,20.736,3.238c13.225,0.357,26.29-1.348,39.537-1.039c7.912,0.184,18.133,2.153,25.912,2.079
                    c2.43-0.023,13.287-1.226,14.932-2.152c5.145-2.896,4.112-19.539,3.651-25.422c-1.453-18.528-9.554-12.596-24.382-13.511
                    c-0.9,0.215-2.317,8.98-9.228,10.009C56.287,23.371,56.772,-4.02,73.81,0.506C79.721,2.076,80.038,7.308,80.939,7.882z"/>
            </svg>
        </div>

        <div class="motif" id="motif-6" data-dimension-w="60.736" data-dimension-h="88.186" data-frequency="0.1">
            <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 60.7 88.2">
                <g id="m6-assembly" class="assembly-collapse">
                    <g id="tree">
                        <path id="branch2" d="M51.7,45.9c0-1.5.2-11,0-16.5,0-1.6-1.5-7-1-7.5,0,0-.8-.6-1.9-.6-1.1,0-2.1.3-2.1.3.6.5,1.1.9,1.1,1,.2,1,.8,12,.7,13.5-.2,2.6-1,4.6-2.5,6.1-1.4,1.4-3.4,2.2-5.9,2.6-1.1.2-3.4.3-6,.3,0,0,1.5,1.1,3.7,1.5,3.9.7,9.7.8,10.8,1,3.5,0,3.2-.3,3.2-1.7Z"/>
                        <path id="branch3" d="M33.9,47.6c5.5.3,11,1,12.3,2.2,1.9,2,3,12.6,2.4,15.5-.1.6-.3,1-.6,1.5,0,0-1.1,1.4,2,.8,1.8-.3,1.6-1.4,1.6-1.4-.2-6.8,0-13.6.1-20.4,0,0-1-1.1-7.2-.3s-10.6,2-10.6,2Z"/>
                        <path id="branch1" d="M34,45.1c-4.4,0-9.7-.2-11.5-.9,0,0-1.1.1-.9,1.8.2,1.7,1.1,1.7,1.1,1.7,2-.3,6.5-.4,11.1-.1h1.2c0,0,17.2,1.2,16.6-.8s-16-1.7-16-1.7h-1.6Z"/>
                    </g>
                    <path id="disc3" d="M51.5,66.2c8.1,2.8,12.3,12.3,6.1,19.2-7.2,8-21.9-2.8-14.7-13.7,1.5-2.2,3.8-3.2,5-4.9,0,0,.5-.6,1.8-.7,1.4,0,1.8.1,1.8.1Z"/>
                    <path id="disc2" d="M46.5,21.6c-1.4-1.1-3.6-2.9-4.6-4.6-10.4-18.3,21-25.3,18.7-3.6-1,9.1-8.9,7.4-10,8.5,0,0-1,.4-2.3.3-1.2,0-1.8-.6-1.8-.6Z"/>
                </g>
                <path id="disc1" d="M22.8,47.8c-.2,0-.4,0-.5,0-1.5.4-1.7,7.9-8.2,9-22.8,3.6-14.9-31.2,3.1-20,3,1.9,3.6,5.8,5,7,.1,0,.3.2.4.3,0,0,.4.6.5,1.8,0,1.4-.2,1.7-.2,1.7Z"/>
            </svg>
        </div>
    </div>

    <script>
        const N = 50;
        const gridScale = 0.75;
        const selector = document.getElementById('motif-selector');
        const pattern = document.querySelector('.pattern');
        const motifTemplates = Array.from(document.querySelectorAll('.motif'));
        const frequencies = motifTemplates.map((motif) => parseFloat(motif.dataset.frequency) || 1);
        const cycleTimerIds = [];
        const colorFrequencies = {
            yellow: 0.1,
            blue: 0.1,
            'light-green': 0.1,
            'dark-green': 0.1,
            pink: 0.1,
            black: 0.5,
        };
        const colorClasses = Object.keys(colorFrequencies);

        function clearCycleTimers() {
            while (cycleTimerIds.length > 0) {
                const timerId = cycleTimerIds.pop();
                clearTimeout(timerId);
                clearInterval(timerId);
            }
        }

        function parseDurationToSeconds(value) {
            const input = (value || '').trim();
            if (!input) return NaN;

            if (input.endsWith('ms')) {
                return parseFloat(input) / 1000;
            }

            if (input.endsWith('s')) {
                return parseFloat(input);
            }

            return parseFloat(input);
        }

        function getCycleDurationSeconds() {
            const rootStyles = getComputedStyle(document.documentElement);
            const raw = rootStyles.getPropertyValue('--cycle-duration');
            const seconds = parseDurationToSeconds(raw);

            if (!Number.isFinite(seconds) || seconds <= 0) return 20;
            return seconds;
        }

        function getWeightedRandomIndex() {
            const totalFrequency = frequencies.reduce((sum, value) => sum + value, 0);
            let random = Math.random() * totalFrequency;
            for (let i = 0; i < frequencies.length; i++) {
                random -= frequencies[i];
                if (random <= 0) return i;
            }
            return frequencies.length - 1;
        }

        function getWeightedRandomColorClass() {
            const totalFrequency = colorClasses.reduce((sum, colorClass) => {
                return sum + (colorFrequencies[colorClass] || 0);
            }, 0);

            let random = Math.random() * totalFrequency;
            for (const colorClass of colorClasses) {
                random -= colorFrequencies[colorClass] || 0;
                if (random <= 0) return colorClass;
            }

            return colorClasses[0];
        }

        function applyCloneBaseStyle(clone, bloomDelay) {
            const cycleDuration = getCycleDurationSeconds();
            const randomDelay = Math.random() * (cycleDuration * 0.15);
            const randomDuration = cycleDuration * (0.5 + Math.random() * 0.3);
            const randomOffset = (Math.random() - 0.5) * 60;
            const randomBottom = 10 + Math.random() * 10;
            const randomMirrorX = Math.random() < 0.5;
            const randomMirrorY = Math.random() < 0.5;
            const allowMirroring = !clone.classList.contains('motif-type-2');
            const randomColorClass = getWeightedRandomColorClass();
            const width = parseFloat(clone.dataset.dimensionW);
            const height = parseFloat(clone.dataset.dimensionH);

            clone.style.setProperty('--bloom-delay', `${bloomDelay}s`);
            clone.style.setProperty('--animation-delay', `${randomDelay}s`);
            clone.style.setProperty('--float-duration', `${randomDuration}s`);
            clone.style.setProperty('--motif-offset', `${randomOffset}px`);
            clone.style.setProperty('--motif-bottom', `${randomBottom}px`);
            clone.classList.toggle('mirror-x', allowMirroring && randomMirrorX);
            clone.classList.toggle('mirror-y', allowMirroring && randomMirrorY);
            clone.classList.add('color');
            clone.classList.remove(...colorClasses);
            clone.classList.add(randomColorClass);
            clone.style.width = `${width * gridScale}px`;
            clone.style.height = `${height * gridScale}px`;
        }

        function applyMotif1Sequence(clone, bloomDelay) {
            const svg = clone.querySelector('svg');
            if (!svg) return;

            const cycleDuration = getCycleDurationSeconds();
            const asCycle = (ratio) => cycleDuration * ratio;

            const disc1 = svg.querySelector('#disc1');
            const branch1 = svg.querySelector('#branch1');
            const branch2 = svg.querySelector('#branch2');
            const branch3 = svg.querySelector('#branch3');
            const branch4 = svg.querySelector('#branch4');
            const branch5 = svg.querySelector('#branch5');
            const disc2 = svg.querySelector('#disc2');
            const disc3 = svg.querySelector('#disc3');
            const disc4 = svg.querySelector('#disc4');
            const disc5 = svg.querySelector('#disc5');
            const disc6 = svg.querySelector('#disc6');

            const growDuration = asCycle(0.035);
            const stepGap = asCycle(0.01);
            const disc1Delay = bloomDelay;
            const branch1Delay = disc1Delay + asCycle(0.0225);
            const branch23Delay = branch1Delay + growDuration;
            const disc23Branch45Delay = branch23Delay + growDuration + stepGap;
            const disc4Delay = disc23Branch45Delay + growDuration + asCycle(0.0075);
            const disc56Delay = disc4Delay + asCycle(0.0175);

            if (disc1) disc1.style.animationDelay = `${disc1Delay}s`;
            if (branch1) branch1.style.animationDelay = `${branch1Delay}s`;

            if (branch2) branch2.style.animationDelay = `${branch23Delay}s`;
            if (branch3) branch3.style.animationDelay = `${branch23Delay}s`;

            if (disc2) disc2.style.animationDelay = `${disc23Branch45Delay}s`;
            if (disc3) disc3.style.animationDelay = `${disc23Branch45Delay}s`;
            if (branch4) branch4.style.animationDelay = `${disc23Branch45Delay}s`;
            if (branch5) branch5.style.animationDelay = `${disc23Branch45Delay}s`;

            if (disc4) disc4.style.animationDelay = `${disc4Delay}s`;

            if (disc5) disc5.style.animationDelay = `${disc56Delay}s`;
            if (disc6) disc6.style.animationDelay = `${disc56Delay}s`;
        }

        function applyMotif2Sequence(clone, bloomDelay) {
            const svg = clone.querySelector('svg');
            if (!svg) return;

            const cycleDuration = getCycleDurationSeconds();
            const asCycle = (ratio) => cycleDuration * ratio;

            const disc1 = svg.querySelector('#disc1');
            const branch1 = svg.querySelector('#branch1');
            const branch2 = svg.querySelector('#branch2');
            const branch3 = svg.querySelector('#branch3');
            const disc2 = svg.querySelector('#disc2');
            const disc3 = svg.querySelector('#disc3');
            const disc4 = svg.querySelector('#disc4');

            const growDuration = asCycle(0.035);
            const stepGap = asCycle(0.01);
            const disc1Delay = bloomDelay;
            const branch1Delay = disc1Delay + asCycle(0.0225);
            const branch23Delay = branch1Delay + growDuration;
            const disc2Delay = branch23Delay + growDuration + stepGap;
            const disc3Delay = disc2Delay + asCycle(0.0125);
            const disc4Delay = disc3Delay + asCycle(0.0125);

            if (disc1) disc1.style.animationDelay = `${disc1Delay}s`;
            if (branch1) branch1.style.animationDelay = `${branch1Delay}s`;
            if (branch2) branch2.style.animationDelay = `${branch23Delay}s`;
            if (branch3) branch3.style.animationDelay = `${branch23Delay}s`;
            if (disc2) disc2.style.animationDelay = `${disc2Delay}s`;
            if (disc3) disc3.style.animationDelay = `${disc3Delay}s`;
            if (disc4) disc4.style.animationDelay = `${disc4Delay}s`;
        }

        function applyMotif6Sequence(clone, bloomDelay) {
            const svg = clone.querySelector('svg');
            if (!svg) return;

            const cycleDuration = getCycleDurationSeconds();
            const asCycle = (ratio) => cycleDuration * ratio;

            const disc1 = svg.querySelector('#disc1');
            const branch1 = svg.querySelector('#branch1');
            const branch2 = svg.querySelector('#branch2');
            const branch3 = svg.querySelector('#branch3');
            const disc2 = svg.querySelector('#disc2');
            const disc3 = svg.querySelector('#disc3');

            const branchGrowDuration = asCycle(0.035);
            const branch3Offset = asCycle(0.01);
            const discsOffset = asCycle(0.0125);
            const disc3Offset = asCycle(0.0075);

            const branch1Delay = bloomDelay + asCycle(0.0225);
            const branch2Delay = branch1Delay + branchGrowDuration;
            const branch3Delay = branch2Delay + branch3Offset;
            const discsDelay = branch3Delay + branchGrowDuration + discsOffset;

            if (disc1) disc1.style.animationDelay = `${bloomDelay}s`;
            if (branch1) branch1.style.animationDelay = `${branch1Delay}s`;
            if (branch2) branch2.style.animationDelay = `${branch2Delay}s`;
            if (branch3) branch3.style.animationDelay = `${branch3Delay}s`;
            if (disc2) disc2.style.animationDelay = `${discsDelay}s`;
            if (disc3) disc3.style.animationDelay = `${discsDelay + disc3Offset}s`;
        }

        function resetMotifCycleState(clone, motifIndex) {
            if (!clone || !clone.isConnected) return;

            const selectorsByMotif = {
                0: ['#branch1', '#branch2', '#branch3', '#branch4', '#branch5', '#disc2', '#disc3', '#disc4', '#disc5', '#disc6'],
                1: ['#branch1', '#branch2', '#branch3', '#disc2', '#disc3', '#disc4'],
                5: ['#branch1', '#branch2', '#branch3', '#disc2', '#disc3'],
            };

            const selectors = selectorsByMotif[motifIndex] || [];
            const elements = selectors
                .map((selector) => clone.querySelector(selector))
                .filter(Boolean);

            if (elements.length === 0) return;

            elements.forEach((element) => {
                element.style.animation = 'none';
            });

            void clone.offsetWidth;

            elements.forEach((element) => {
                element.style.animation = '';
            });

            if (motifIndex === 0) {
                applyMotif1Sequence(clone, 0);
            }

            if (motifIndex === 1) {
                applyMotif2Sequence(clone, 0);
            }

            if (motifIndex === 5) {
                applyMotif6Sequence(clone, 0);
            }
        }

        function scheduleCloneCycleReset(clone, motifIndex, bloomDelay) {
            if (motifIndex !== 0 && motifIndex !== 1 && motifIndex !== 5) return;

            const cycleDuration = getCycleDurationSeconds();
            const firstResetDelayMs = (bloomDelay + cycleDuration) * 1000;
            const cycleMs = cycleDuration * 1000;

            let intervalId;
            const timeoutId = window.setTimeout(() => {
                if (!clone.isConnected) return;

                const runReset = () => {
                    if (!clone.isConnected) {
                        clearInterval(intervalId);
                        return;
                    }
                    resetMotifCycleState(clone, motifIndex);
                };

                runReset();
                intervalId = window.setInterval(runReset, cycleMs);
                cycleTimerIds.push(intervalId);
            }, firstResetDelayMs);

            cycleTimerIds.push(timeoutId);
        }

        function createClone(index, randomIndex, bloomDelay) {
            const clone = motifTemplates[randomIndex].cloneNode(true);
            clone.id = `motif-clone-${index}`;
            clone.classList.add(`motif-type-${randomIndex + 1}`);
            if (randomIndex === 5) clone.classList.add('motif-type-6');

            applyCloneBaseStyle(clone, bloomDelay);

            if (randomIndex === 0 || clone.classList.contains('motif-type-1')) {
                applyMotif1Sequence(clone, bloomDelay);
            }

            if (randomIndex === 1 || clone.classList.contains('motif-type-2')) {
                applyMotif2Sequence(clone, bloomDelay);
            }

            if (randomIndex === 5 || clone.classList.contains('motif-type-6')) {
                applyMotif6Sequence(clone, bloomDelay);
            }

            scheduleCloneCycleReset(clone, randomIndex, bloomDelay);

            return clone;
        }

        function generateRandomMotifs(count = N) {
            clearCycleTimers();
            pattern.innerHTML = '';
            const columnsCount = 3;
            const generatedIndices = [];

            for (let index = 0; index < count; index++) {
                let randomIndex;
                let attempts = 0;

                do {
                    randomIndex = getWeightedRandomIndex();
                    attempts += 1;
                    if (attempts > 100) break;
                } while (
                    (index >= 1 && randomIndex === generatedIndices[index - 1]) ||
                    (index >= columnsCount && randomIndex === generatedIndices[index - columnsCount])
                );

                generatedIndices[index] = randomIndex;
                const bloomDelay = Math.random() * getCycleDurationSeconds();
                const clone = createClone(index, randomIndex, bloomDelay);
                pattern.appendChild(clone);
            }
        }

        function showAllMotifs() {
            pattern.classList.remove('single-view');
            generateRandomMotifs(N);
        }

        function showSingleMotif(index) {
            clearCycleTimers();
            pattern.innerHTML = '';
            pattern.classList.add('single-view');

            const clone = motifTemplates[index].cloneNode(true);
            const width = parseFloat(clone.dataset.dimensionW);
            const height = parseFloat(clone.dataset.dimensionH);
            const singleScale = 2;
            const bloomDelay = 0;

            clone.classList.add(`motif-type-${index + 1}`);
            if (index === 5) clone.classList.add('motif-type-6');

            clone.style.setProperty('--bloom-delay', `${bloomDelay}s`);
            clone.style.setProperty('--animation-delay', '0s');
            clone.style.setProperty('--float-duration', '8s');
            clone.style.setProperty('--motif-offset', '0px');
            clone.style.setProperty('--motif-bottom', '0px');

            if (index === 0) {
                applyMotif1Sequence(clone, bloomDelay);
            }

            if (index === 1) {
                applyMotif2Sequence(clone, bloomDelay);
            }

            if (index === 5) {
                applyMotif6Sequence(clone, bloomDelay);
            }

            scheduleCloneCycleReset(clone, index, bloomDelay);

            clone.id = 'motif-single';
            clone.style.width = `${width * singleScale}px`;
            clone.style.height = `${height * singleScale}px`;
            pattern.appendChild(clone);
        }

        selector.addEventListener('change', (event) => {
            const value = event.target.value;
            if (value === 'all') {
                showAllMotifs();
                return;
            }
            showSingleMotif(parseInt(value, 10));
        });

        window.addEventListener('DOMContentLoaded', () => {
            showAllMotifs();
        });
    </script>
